class CCPopover{constructor(t){this.$el=t,this.animation=t.getAttribute("data-ccp-animation"),this.delayParsed=t.getAttribute("data-ccp-delay")?JSON.parse(t.getAttribute("data-ccp-delay")):null,this.delay=this.delayParsed?1e3*this.delayParsed[0]:null,this.delayOut=this.delayParsed?1e3*this.delayParsed[1]:null,this.interactive=t.getAttribute("data-ccp-interactive"),this.disableFocus=t.getAttribute("data-ccp-disable-focus"),this.shift=t.getAttribute("data-ccp-shift"),this.flip=t.getAttribute("data-ccp-flip"),this.offset=t.getAttribute("data-ccp-offset"),this.placement=t.getAttribute("data-ccp-placement"),this.position=t.getAttribute("data-ccp-position"),this.triggerID=t.getAttribute("data-ccp-trigger"),this.hideType=t.getAttribute("data-ccp-hide"),this.trigger=t.getAttribute("data-ccp-trigger_type"),this.args,this.$trigger=document.querySelector(`#${this.triggerID}`),this.$trigger&&this.$el&&(this.init(),this.events()),this.outsideListener=this.outsideListener.bind(this),this.handleInteractive=this.handleInteractive.bind(this).ccThrottle(50),this.mouseLeaveListener=this.mouseLeaveListener.bind(this),this.handleMouseEnter=this.handleMouseEnter.bind(this),this.handleMouseLeave=this.handleMouseLeave.bind(this),this.mouseEnterListener=this.mouseEnterListener.bind(this),this.mouseTriggerEnterListener=this.mouseTriggerEnterListener.bind(this),this.removeVideo=this.removeVideo.bind(this),this.mouseHoverTimeout,this.mouseEnterTimeout,this.floatPlacement,this.isListeningMouseOut=!1,this.isTriggering=!1,this.isInteracting=!1,this.isOverridden=!1,this.onKeydown=this.handleKey.bind(this),this.isOpen=!1,this.updatePosition=this.updatePosition.bind(this),this.cleanupRef}updatePosition(){FloatingUIDOM.computePosition(this.$trigger,this.$el,this.args).then(({x:t,y:e,placement:i})=>{this.floatPlacement=i,Object.assign(this.$el.style,{left:`${t}px`,top:`${e}px`,position:this.position?this.position:"absolute"}),this.$el.setAttribute("data-ccp-placement",i)})}cleanup(){FloatingUIDOM.autoUpdate(this.$trigger,this.$el,this.updatePosition)}init(){const t={middleware:[]};this.placement&&(t.placement=this.placement),this.offset&&t.middleware.push(FloatingUIDOM.offset(parseInt(this.offset))),this.shift&&t.middleware.push(FloatingUIDOM.shift()),this.flip&&t.middleware.push(FloatingUIDOM.flip()),this.position&&(t.position=this.position),this.args=t,this.$trigger.setAttribute("aria-expanded","false"),this.$trigger.setAttribute("data-ccp-state","closed"),FloatingUIDOM.computePosition(this.$trigger,this.$el,t).then(({x:t,y:e,placement:i})=>{this.floatPlacement=i,Object.assign(this.$el.style,{left:`${t}px`,top:`${e}px`,position:this.position?this.position:"absolute"}),this.$el.setAttribute("data-ccp-placement",i)})}events(){"click"===this.trigger?this.$trigger.addEventListener("click",this.handleClick.bind(this)):"hover"===this.trigger&&this.$trigger.addEventListener("pointerenter",this.handleMouseEnter.bind(this)),this.$trigger.addEventListener("focus",this.handleFocus.bind(this)),this.$trigger.addEventListener("blur",this.handleBlur.bind(this))}open(){this.$el.setAttribute("data-ccp-state","visible"),this.$trigger.setAttribute("aria-expanded","true"),this.$trigger.setAttribute("data-ccp-state","open"),this.isOpen=!0,"click"===this.trigger&&(setTimeout(()=>{this.setFocusToFirstNode()},100),this.$el.addEventListener("keydown",this.onKeydown,!1));const t=new CustomEvent("data-popover",{detail:{id:this.$el.id,state:"open"}});document.dispatchEvent(t),this.cleanup()}close(){this.$el.setAttribute("data-ccp-state","hidden"),this.$trigger.setAttribute("aria-expanded","false"),this.$trigger.setAttribute("data-ccp-state","closed"),this.isOpen=!1,"click"===this.trigger&&this.$el.removeEventListener("keydown",this.onKeydown);const t=new CustomEvent("data-popover",{detail:{id:this.$el.id,state:"closed"}});document.dispatchEvent(t),this.cleanupRef}getFocusableNodes(){const t=this.$el.querySelectorAll(["a[href]","area[href]",'input:not([disabled]):not([type="hidden"]):not([aria-hidden])',"select:not([disabled]):not([aria-hidden])","textarea:not([disabled]):not([aria-hidden])","button:not([disabled]):not([aria-hidden])","iframe","object","embed","[contenteditable]",'[tabindex]:not([tabindex^="-"])']);return Array(...t)}retainFocus(t){if(this.disableFocus)return;let e=this.getFocusableNodes();if(0!==e.length)if(e=e.filter(t=>null!==t.offsetParent),this.$el.contains(document.activeElement)){const i=e.indexOf(document.activeElement);t.shiftKey&&0===i&&(e[e.length-1].focus(),t.preventDefault()),!t.shiftKey&&e.length>0&&i===e.length-1&&(e[0].focus(),t.preventDefault())}else t.preventDefault(),e[0].focus()}setFocusToFirstNode(){if(this.disableFocus)return;const t=this.getFocusableNodes();if(0===t.length)return;const e=t.filter(t=>!t.classList.contains("close"));e.length>0&&e[0].focus(),0===e.length&&t[0].focus()}handleKey(t){27===t.keyCode&&this.isOpen&&this.hide(this.delayOut),9===t.keyCode&&this.retainFocus(t)}handleClick(t){"hidden"!==this.$el.getAttribute("data-ccp-state")||this.isTriggering?this.hide(this.delayOut):this.show(this.delay)}handleMouseEnter(t){"hidden"!==this.$el.getAttribute("data-ccp-state")||this.isTriggering||(this.show(this.delay),this.interactive&&(document.addEventListener("pointermove",this.handleInteractive),this.isListeningMouseOut=!0))}handleMouseLeave(t){"visible"!==this.$el.getAttribute("data-ccp-state")||this.isTriggering||this.hide(this.delayOut)}handleFocus(t){"hidden"!==this.$el.getAttribute("data-ccp-state")||this.isTriggering||"click"===this.trigger||this.show(this.delay)}handleBlur(t){"visible"!==this.$el.getAttribute("data-ccp-state")||this.isTriggering||"click"===this.trigger||this.hide(this.delayOut)}handleInteractive(t){this.$trigger.contains(t.target)||this.$el.contains(t.target)||"visible"!==this.$el.getAttribute("data-ccp-state")||!function(t,e,i,s){const{clientX:n,clientY:r}=s,{top:o,left:h,bottom:a,right:d}=t.getBoundingClientRect(),c=function(t){return t.split("-")[0]}(e),l=i?parseInt(i):0;return!l||o-r-("bottom"===c?l:0)>0||r-a-("top"===c?l:0)>0||h-n-("right"===c?l:0)>0||n-d-("left"===c?l:0)>0}(this.$el,this.floatPlacement,this.offset,t)||this.isInteracting||(this.isInteracting=!0,this.delayOut?(this.$el.addEventListener("pointerenter",this.mouseEnterListener),this.$trigger.addEventListener("pointerenter",this.mouseTriggerEnterListener),this.mouseEnterTimeout=setTimeout(()=>{this.hide(),document.removeEventListener("pointermove",this.handleInteractive),this.$el.removeEventListener("pointerenter",this.mouseEnterListener),this.$trigger.removeEventListener("pointerenter",this.mouseTriggerEnterListener),this.isListeningMouseOut=!1,this.isInteracting=!1},this.delayOut)):(this.hide(),document.removeEventListener("pointermove",this.handleInteractive),this.isListeningMouseOut=!1,this.isInteracting=!1))}show(t=0){this.isOverridden||(this.isTriggering=!0,"click"===this.trigger?t?"hidden"===this.$el.getAttribute("data-ccp-state")&&setTimeout(()=>{this.open(),document.addEventListener("click",this.outsideListener),this.isTriggering=!1},t):(this.open(),document.addEventListener("click",this.outsideListener),this.isTriggering=!1):"hover"!==this.trigger&&"focus"!==this.trigger||(this.interactive?t?this.isListeningMouseOut||(this.$trigger.addEventListener("pointerout",this.mouseLeaveListener),this.mouseHoverTimeout=setTimeout(()=>{this.open(),document.addEventListener("pointermove",this.handleInteractive),this.isTriggering=!1,this.isListeningMouseOut=!0,this.$trigger.removeEventListener("pointerout",this.mouseLeaveListener)},t)):(this.open(),document.addEventListener("pointermove",this.handleInteractive),this.isTriggering=!1,this.isListeningMouseOut=!0):t?(this.$trigger.addEventListener("pointerout",this.mouseLeaveListener),this.mouseHoverTimeout=setTimeout(()=>{this.open(),this.isTriggering=!1,this.$trigger.removeEventListener("pointerout",this.mouseLeaveListener),this.$trigger.addEventListener("pointerout",this.handleMouseLeave.bind(this))},t)):(this.open(),this.isTriggering=!1,this.$trigger.addEventListener("pointerout",this.handleMouseLeave.bind(this)))))}hide(t=0){if(!this.isOverridden)if(t)"visible"===this.$el.getAttribute("data-ccp-state")&&setTimeout(()=>{"click"===this.trigger?(this.close(),document.removeEventListener("click",this.outsideListener)):this.close()},t);else{if("click"===this.trigger?(this.close(),document.removeEventListener("click",this.outsideListener)):this.close(),0===this.$el.querySelectorAll("iframe").length&&0===this.$el.querySelectorAll("video").length)return;this.$el.addEventListener("transitionend",this.removeVideo)}}removeVideo(){const t=this.$el.innerHTML;this.$el.innerHTML=t,this.$el.removeEventListener("transitionend",this.removeVideo)}showHide(t=0,e=0){this.isOverridden||(this.isOverridden=!0,t?"hidden"===this.$el.getAttribute("data-ccp-state")&&setTimeout(()=>{this.open(),this.isOverridden=!1},t):(this.open(),this.isOverridden=!1),e?setTimeout(()=>{"visible"===this.$el.getAttribute("data-ccp-state")&&(this.close(),this.isOverridden=!1)},e+t):"visible"===this.$el.getAttribute("data-ccp-state")&&(this.close(),this.isOverridden=!1))}outsideListener(t){"click"===this.trigger&&(("onClick"!==this.hideType||this.$trigger.contains(t.target))&&("onClickOut"!==this.hideType||this.$trigger.contains(t.target)||this.$el.contains(t.target))?"onClickIn"===this.hideType&&!this.$trigger.contains(t.target)&&this.$el.contains(t.target)&&this.hide(this.delayOut):this.hide(this.delayOut))}mouseLeaveListener(){clearTimeout(this.mouseHoverTimeout),this.mouseHoverTimeout=null,this.isTriggering=!1,this.isListeningMouseOut=!1,this.$trigger.removeEventListener("pointerout",this.mouseLeaveListener),document.removeEventListener("pointermove",this.handleInteractive)}mouseEnterListener(){clearTimeout(this.mouseEnterTimeout),this.mouseEnterTimeout=null,this.$el.removeEventListener("pointerenter",this.mouseEnterListener),this.isInteracting=!1}mouseTriggerEnterListener(){clearTimeout(this.mouseEnterTimeout),this.mouseEnterTimeout=null,this.$trigger.removeEventListener("pointerenter",this.mouseTriggerEnterListener),this.isInteracting=!1}destroy(){"click"===this.trigger?(this.$trigger.removeEventListener("click",this.clickListener),document.removeEventListener("click",this.outsideListener)):(this.$trigger.removeEventListener("pointerenter",this.mouseEnterListener),this.$trigger.removeEventListener("pointerenter",this.mouseTriggerEnterListener),this.$trigger.removeEventListener("pointerout",this.mouseLeaveListener),this.$trigger.removeEventListener("pointermove",this.handleInteractive))}}window.addEventListener("load",function(){const t=document.querySelectorAll("[data-ccp-trigger_type]");t&&t.forEach(t=>{window[`cc-popover-${t.id}`]=new CCPopover(t)}),document.addEventListener("cc-popovers",t=>{window[`cc-popover-${t.detail.id}`]?(window[`cc-popover-${t.detail.id}`].destroy(),window[`cc-popover-${t.detail.id}`]=new CCPopover(document.querySelector(`#${t.detail.id}`))):t.detail.id&&document.querySelector(`#${t.detail.id}`)&&!window[`cc-popover-${t.detail.id}`]&&(window[`cc-popover-${t.detail.id}`]=new CCPopover(document.querySelector(`#${t.detail.id}`)))})}),Function.prototype.ccThrottle=function(t,e){var i=this,s=null,n=t;return function(){var t=e||this,r=arguments,o=Date.now();(!s||o-s>=n)&&(s=o,i.apply(t,r))}};