class CCModal{constructor(e,t){this.$el=e,this.modalID=e.id,this.$closeOverlay=this.$el.querySelector('.cc-mdl-close[aria-hidden="true"]'),this.$container=this.$el.querySelector(".cc-modaler"),this.disableScroll=this.$el.getAttribute("data-preventpagescroll"),this.resetScrollPosition=this.$el.getAttribute("data-resetscrollposition"),this.closeOnOverlay=this.$el.getAttribute("data-closeoverlay"),this.isOpen=!1,this.duration=this.$el.getAttribute("data-modalduration")?this.$el.getAttribute("data-modalduration"):.4,this.disableFocus=!1,this.currentTime=(new Date).getTime(),this.lastShownTime=!(!localStorage||!localStorage["cc-"+this.modalID+"-last-shown-time"])&&JSON.parse(localStorage["cc-"+this.modalID+"-last-shown-time"]),this.numberShownTime=!(!localStorage||!localStorage["cc-"+this.modalID+"-number-shown-time"])&&JSON.parse(localStorage["cc-"+this.modalID+"-number-shown-time"]),this.settingDays=!!this.$el.getAttribute("data-after")&&this.$el.getAttribute("data-after"),this.actualDays=(this.currentTime-this.lastShownTime)/864e5,this.every=!!this.$el.getAttribute("data-every")&&this.$el.getAttribute("data-every"),this.upto=!!this.$el.getAttribute("data-upto")&&this.$el.getAttribute("data-upto"),this.never=!!this.$el.getAttribute("data-never")&&this.$el.getAttribute("data-never"),this.onClick=this.handleCloseOverlay.bind(this),this.onKeydown=this.handleKey.bind(this)}addEventListeners(){this.$closeOverlay.addEventListener("touchstart",this.onClick),this.$closeOverlay.addEventListener("click",this.onClick),document.addEventListener("keydown",this.onKeydown,!1)}removeEventListeners(){document.removeEventListener("keydown",this.onKeydown,!1)}handleCloseOverlay(e){e.preventDefault(),this.isOpen&&this.closeOnOverlay&&this.close()}handleKey(e){27===e.keyCode&&window.CCOpenModals&&window.CCOpenModals[window.CCOpenModals.length-1]===this.$el.id&&this.close(e),9===e.keyCode&&this.retainFocus(e)}open(e=null){!1===this.isOpen&&((!this.lastShownTime&&this.never||this.upto&&this.numberShownTime<this.upto||this.settingDays&&this.actualDays>this.settingDays||this.every)&&(this.$el.classList.add("active"),this.addEventListeners(),this.scrollBehaviour("disable"),window.CCOpenModals?window.CCOpenModals.push(this.$el.id):window.CCOpenModals=[this.$el.id],window.CCOpenModals?window.CCOpenModals.push(this.$el.id):window.CCOpenModals=[this.$el.id],this.isOpen=!0,this.setStateForTriggers(!0)),(this.never||this.settingDays)&&(this.settingDays&&this.actualDays>this.settingDays||this.never)&&localStorage&&(localStorage["cc-"+this.modalID+"-last-shown-time"]=JSON.stringify(this.currentTime)),this.upto&&localStorage&&(localStorage["cc-"+this.modalID+"-number-shown-time"]=this.numberShownTime?this.numberShownTime+1:1))}close(e=null){if(!0===this.isOpen){if(this.$el.classList.remove("active"),this.removeEventListeners(),this.scrollBehaviour("enable"),window.CCOpenModals&&(window.CCOpenModals=window.CCOpenModals.filter(e=>e!==this.$el.id)),this.setStateForTriggers(!1),this.isOpen=!1,this.resetScrollPosition&&setTimeout(()=>{this.$el.scrollTop=0;const e=this.$el.getElementsByTagName("*");for(let t=0;t<e.length;t++)e[t].scrollTop=0},1e3*this.duration),0===this.$el.querySelectorAll("iframe").length&&0===this.$el.querySelectorAll("video").length)return;setTimeout(()=>{const e=this.$el.querySelectorAll("iframe, video");for(let t=0;t<e.length;t++){const o=e[t],i=o.cloneNode(!0);o.outerHTML=i.outerHTML}},1e3*this.duration)}}toggle(e=null){!1===this.isOpen?this.open():!0===this.isOpen&&this.close()}setStateForTriggers(e){const t=document.querySelectorAll(`[data-modalid="${this.$el.id}"]`);t&&t.forEach(t=>{e?t.setAttribute("modal-open",e):t.removeAttribute("modal-open")})}scrollBehaviour(e){if(!this.disableScroll)return;const t=document.querySelector("body");switch(e){case"enable":Object.assign(t.style,{overflow:""});break;case"disable":Object.assign(t.style,{overflow:"hidden"})}}getFocusableNodes(){const e=this.$container.querySelectorAll(["a[href]","area[href]",'input:not([disabled]):not([type="hidden"]):not([aria-hidden])',"select:not([disabled]):not([aria-hidden])","textarea:not([disabled]):not([aria-hidden])","button:not([disabled]):not([aria-hidden])","iframe","object","embed","[contenteditable]",'[tabindex]:not([tabindex^="-"])']);return Array(...e)}retainFocus(e){if(this.disableFocus)return;let t=this.getFocusableNodes();if(0!==t.length)if(t=t.filter(e=>null!==e.offsetParent),this.$el.contains(document.activeElement)){const o=t.indexOf(document.activeElement);e.shiftKey&&0===o&&(t[t.length-1].focus(),e.preventDefault()),!e.shiftKey&&t.length>0&&o===t.length-1&&(t[0].focus(),e.preventDefault())}else e.preventDefault(),t[0].focus()}setFocusToFirstNode(){if(this.disableFocus)return;const e=this.getFocusableNodes();if(0===e.length)return;const t=e.filter(e=>!e.classList.contains("cc-mdl-close"));t.length>0&&t[0].focus(),0===t.length&&e[0].focus()}}function cc_open_modal(e){e&&window[`cc-modal-${e}`]&&window[`cc-modal-${e}`].open()}function cc_modal_triggers(e,t,o){const i=document.getElementById(e);if("click"===t){let t=0;document.addEventListener("click",function i(){(t+=1)===parseInt(o)&&(cc_open_modal(e),document.removeEventListener("click",i))},!1)}if("load"===t&&setTimeout(function(){cc_open_modal(e)},1e3*parseInt(o)),"exit"===t&&(window["cc-"+e+"-onExit"]=function(t){t.toElement||t.relatedTarget||(cc_open_modal(e),document.removeEventListener("mouseout",window["cc-"+e+"-onExit"]))},document.addEventListener("mouseout",window["cc-"+e+"-onExit"])),"inactivity"===t&&cc_modal_idle_activity(e,o),"url"===t&&(document.referrer===o&&"show"===i.dataset.urlcondition&&cc_open_modal(e),document.referrer!=o&&"hide"===i.dataset.urlcondition&&cc_open_modal(e)),"scroll"===t){let t=0,n=window.scrollY;window["cc-"+e+"-onScroll"]=function(){let l=n>window.scrollY;n=window.scrollY;let s=document.documentElement,a=document.body,d="scrollTop",c="scrollHeight";(s[d]||a[d])/((s[c]||a[c])-s.clientHeight)*100>=o&&0===t&&"down"===i.dataset.scrolldirection&&!l&&(t+=1,cc_open_modal(e),document.removeEventListener("scroll",window["cc-"+e+"-onScroll"])),0===t&&"up"===i.dataset.scrolldirection&&l&&(t+=1,cc_open_modal(e),document.removeEventListener("scroll",window["cc-"+e+"-onScroll"]))},document.addEventListener("scroll",window["cc-"+e+"-onScroll"])}"addedtocart"===t&&jQuery("body").on("added_to_cart",function(){cc_open_modal(e)})}function cc_modal_idle_activity(e,t){let o,i=0;function n(){0===i&&(cc_open_modal(e),i=1)}function l(){clearTimeout(o),o=setTimeout(n,1e3*t)}window.onload=l,window.onmousemove=l,window.onmousedown=l,window.ontouchstart=l,window.onclick=l,window.onkeydown=l,window.addEventListener("scroll",l,!0)}function cc_closeAllModals(){window.CCOpenModals&&window.CCOpenModals.forEach(e=>{window[`cc-modal-${e}`]&&window[`cc-modal-${e}`].close()})}function cc_modal_open(e){const t=document.querySelectorAll("[data-modal]");t.length&&t.forEach(function(t){if((t===e.target||t.contains(e.target))&&t.dataset.modalid){var o=!(!t.dataset||!t.dataset.modalid)&&t.dataset.modalid;o&&window[`cc-modal-${o}`]&&window[`cc-modal-${o}`].open()}})}function cc_modal_close(e){const t=document.querySelectorAll('[data-modalclose], .cc-mdl-close:not([aria-hidden="true"])');t.length&&t.forEach(function(t){if(t===e.target||t.contains(e.target))if(t.dataset.modalid){var o=!(!t.dataset||!t.dataset.modalid)&&t.dataset.modalid;o&&window[`cc-modal-${o}`]&&window[`cc-modal-${o}`].close()}else{const e=t.closest(".cc-mdl");e&&window[`cc-modal-${e.id}`]&&window[`cc-modal-${e.id}`].close()}})}function cc_modal_toggle(e){const t=document.querySelectorAll("[data-modaltoggle]");t.length&&t.forEach(function(t){if((t===e.target||t.contains(e.target))&&t.dataset.modalid){var o=!(!t.dataset||!t.dataset.modalid)&&t.dataset.modalid;o&&window[`cc-modal-${o}`]&&window[`cc-modal-${o}`].toggle()}})}window.addEventListener("load",function(){document.querySelectorAll("[data-ccself]").length&&document.querySelectorAll("[data-ccself]").forEach(function(e){e.dataset.openclick&&cc_modal_triggers(e.id,"click",e.dataset.openclick),e.dataset.onload&&cc_modal_triggers(e.id,"load",e.dataset.onload),e.dataset.onscroll&&cc_modal_triggers(e.id,"scroll",e.dataset.onscroll),e.dataset.exitintent&&cc_modal_triggers(e.id,"exit"),e.dataset.inactive&&cc_modal_triggers(e.id,"inactivity",e.dataset.inactive),e.dataset.url&&cc_modal_triggers(e.id,"url",e.dataset.url),e.dataset.addedtocart&&cc_modal_triggers(e.id,"addedtocart")})}),window.addEventListener("load",function(){const e=document.querySelectorAll(".cc-mdl");if(e){const t=document.querySelector(".wp-site-blocks");e.forEach(e=>{t.insertAdjacentElement("afterend",e),window[`cc-modal-${e.id}`]=new CCModal(e)})}});